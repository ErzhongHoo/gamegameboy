#!/usr/bin/env node

// Script to generate games_data.js from generated_games.json
const fs = require('fs');

// ËØªÂèñJSONÊñá‰ª∂
const jsonPath = './generated_games.json';
const outputPath = './games_data.js';

try {
    console.log('üìñ Reading JSON database...');
    const jsonData = fs.readFileSync(jsonPath, 'utf8');
    const gamesData = JSON.parse(jsonData);

    console.log('üìä Found games in categories:');
    Object.keys(gamesData).forEach(category => {
        console.log(`  ${category}: ${gamesData[category].length} games`);
    });

    // ÁîüÊàêJavaScriptÊñá‰ª∂ÂÜÖÂÆπ
    let jsContent = `// Games data embedded directly in JavaScript
// This file is automatically generated from generated_games.json
// Generated on: ${new Date().toISOString()}
// Total games: ${Object.values(gamesData).reduce((sum, games) => sum + games.length, 0)}

const GAMES_DATABASE = ${JSON.stringify(gamesData, null, 2)};

// ÊâÅÂπ≥ÂåñÁöÑÊ∏∏ÊàèÂàóË°®Áî®‰∫éÊêúÁ¥¢
const ALL_GAMES = [];
for (const [category, games] of Object.entries(GAMES_DATABASE)) {
    if (Array.isArray(games)) {
        games.forEach(game => {
            if (game && game.name) {
                ALL_GAMES.push({
                    ...game,
                    category: game.classification || category
                });
            }
        });
    }
}

console.log('üìà Total games loaded for search:', ALL_GAMES.length);

// ÂØºÂá∫Êï∞ÊçÆ‰æõÊêúÁ¥¢Á≥ªÁªü‰ΩøÁî®
if (typeof module !== 'undefined' && module.exports) {
    module.exports = { GAMES_DATABASE, ALL_GAMES };
} else if (typeof window !== 'undefined') {
    window.GAMES_DATABASE = GAMES_DATABASE;
    window.ALL_GAMES = ALL_GAMES;
}
`;

    // ÂÜôÂÖ•Êñá‰ª∂
    fs.writeFileSync(outputPath, jsContent);
    console.log('‚úÖ Successfully generated games_data.js');
    console.log(`üìÅ Output file: ${outputPath}`);
    console.log(`üìä Total games included: ${Object.values(gamesData).reduce((sum, games) => sum + games.length, 0)}`);

    // Ê£ÄÊü•Gold MinerÊòØÂê¶ÂåÖÂê´Âú®ÂÜÖ
    let goldMinerFound = false;
    Object.values(gamesData).forEach(games => {
        games.forEach(game => {
            if (game.name && game.name.toLowerCase().includes('gold miner')) {
                console.log(`‚úÖ Found Gold Miner: ${game.name} in ${game.file}`);
                goldMinerFound = true;
            }
        });
    });

    if (!goldMinerFound) {
        console.log('‚ö†Ô∏è Gold Miner not found in the database!');
    }

} catch (error) {
    console.error('‚ùå Error generating games_data.js:', error);
    process.exit(1);
}